/*! my-project-name 2015-11-25 */
var AcquiredThing=function(){var a=function(){return{update:function(){this.x=this.owner.x,this.y=this.owner.top-20,this.scale.x+=this.spin,this.scale.x<=0&&("front"===this.animations.currentAnim.name?this.animations.play("back"):this.animations.play("front")),(this.scale.x<=0||this.scale.x>=1)&&(this.spin*=-1)}}}();return{create:function(b,c){b.acquiredThing&&b.acquiredThing.kill&&b.acquiredThing.kill();var d=b.acquiredThing=game.add.sprite(b.x,b.top-20,c);return d.animations.add("front",[0]),d.animations.add("back",[0]),d.anchor.set(.5,1),d.owner=b,d.spin=-.025,util.assignAllFunctions(d,a),d.update=a.update,zOrder.putInLayer(d,"FLOAT"),d}}}(),Airplane=function(){var a=function(){var a,b={font:"20px Sans",fill:"#fff",align:"center"},c=game.add.text(game.width/2,game.height/2,"Se acabó el tiempo, y perdiste tu vuelo",b);c.anchor.set(.5,.5),c.fixedToCamera=!0,zOrder.putInLayer(c,"TEXT"),a=game.add.button(game.width/2,game.height/2+100,"try-again-button",this.level.restart,this.level,0,1),a.anchor.set(.5),a.fixedToCamera=!0,zOrder.putInLayer(a,"TEXT"),loader.hush()};return{create:function(b){var c=game.add.sprite(b.x-450,config.street.floor,"airplane");return c.level=b.level,c.sound=game.add.audio("airplane"),c.sound.play(),c.sendToBack(),c.level=b.level,game.camera.followPc=!1,game.camera.unfollow(),c.level.pc.destroy(),console.log("do not destroy it!!"),game.camera.tween=game.add.tween(c).to({y:game.camera.y-3e3,rotation:Math.PI/6},8e3,Phaser.Easing.Quadratic.In,!0),game.camera.tween=game.add.tween(c).to({x:game.camera.x-6e3},6e3,Phaser.Easing.Linear.In,!0),game.camera.tween=game.add.tween(game.camera).to({y:game.camera.y-3e3},8e3,Phaser.Easing.Quadratic.In,!0),game.camera.tween=game.add.tween(game.camera).to({x:game.camera.x-6500},6e3,Phaser.Easing.Linear.In,!0),zOrder.putInLayer(c,"PLANE"),b.level.lost?game.time.events.add(6500,a,c):game.time.events.add(6500,Photo.create,c.level),loader.hush(),c}}}(),Airport=function(){var a=function(){return{canBeUsed:function(){return this.level.pc.acquiredThing&&"ticket"===this.level.pc.acquiredThing.key&&this.level.pc.alive},beUsed:function(){this.level.pc.kill(),this.level.pc.acquiredThing&&this.level.pc.acquiredThing.kill&&this.level.pc.acquiredThing.kill(),game.time.events.add(2e3,function(){Airplane.create(this)},this)}}}();return{create:function(b,c){var d=Local.create(config.street.airport,{x:380},c,"airport");return d.anchor.set(.6,1),d.level=c,zOrder.putInLayer(d,"LOCAL"),util.assignAllFunctions(d,a),d}}}(),Atm=function(){var a=function(){var a=function(){return{pop:function(){this.kill()}}}();return{create:function(b){var c=game.add.sprite(b.x,b.header.y-b.header.height-10,"dialogue"),d=b.pc.acquiredThing;return c.anchor.set(.5,1),c.animations.add("1",[0]),c.animations.add("2",[1]),d?c.animations.play("2"):c.animations.play("1"),zOrder.putInLayer(c,"FLOAT"),util.assignAllFunctions(c,a),game.time.events.add(4500,c.pop,c),c}}}(),b=function(){return{done:function(){var a=Card.create(this.pc);return Local.Instance.done.call(this),a},beUsed:function(){game.time.events.add(config.wait.atm/5,a.create,a,this),Local.Instance.beUsed.call(this),game.time.events.add(config.wait.atm,this.done,this)},canBeUsed:function(){return!this.pc.acquiredThing||"stolen-"===this.pc.acquiredThing.key.substring(0,7)}}}();return{create:function(a,c){var d=Local.create(a,{x:300},c,"atm");return d.header=game.add.sprite(a,config.street.wall-d.height,selectedBank.bank),d.header.anchor.set(.5,1),zOrder.putInLayer(d.header,"LOCAL"),util.assignAllFunctions(d,b),d}}}(),Background=function(){var a=function(){return{update:function(){this.tilePosition.x=game.camera.x*this.zFactor-this.offset,this.alpha=1}}}();return{create:function(){var b=game.add.tileSprite(0,game.height,8700,560,"mountains");b.zFactor=config.street.parallax.mountains,zOrder.putInLayer(b,"MOUNTAINS"),b.offset=-200;var c=game.add.tileSprite(0,game.height,8700,560,"town");c.zFactor=config.street.parallax.town,zOrder.putInLayer(c,"TOWN"),c.offset=100;var d=game.add.tileSprite(0,560,8560,560,"tile-street");return d.zFactor=0,zOrder.putInLayer(d,"FACADE"),d.offset=0,d.update=c.update=b.update=a.update,qwer=d,console.log(qwer),{mountains:b,town:c,floor:d}}}}(),BankCarousell=function(){var a=function(){return{up:function(){var a;if(this.selected>0)for(height=this.bancos[this.selected].height,this.selected--,a=0;a<this.bancos.length;a++)game.add.tween(this.bancos[a]).to({y:a*height-this.selected*height+game.height/2},300,Phaser.Easing.Exponential.Out,!0)},down:function(){var a,b;if(this.selected<this.bancos.length-1)for(b=this.bancos[this.selected].height,this.selected++,a=0;a<this.bancos.length;a++)game.add.tween(this.bancos[a]).to({y:a*b-this.selected*b+game.height/2},300,Phaser.Easing.Exponential.Out,!0)},getSelectedBank:function(){return this.bancos[this.selected]}}}();return{create:function(){var b,c,d=0,e={bancos:[],offset:0,selected:0};for(util.assignAllFunctions(e,a),b=0;b<bancos.length;b++)bancos[b].enabled&&(c=game.add.sprite(0,0,bancos[b].nombre),e.bancos.push(c),c.x=game.width/2,c.y=game.height/2+d*(c.height+e.offset),c.anchor.set(.5),d++);return e}}}(),bankSelection=function(){return{preload:function(){util.loadBanks(),game.load.image("pick-a-bank","assets/retail/full-screens/elige-banco.png"),game.load.spritesheet("arrow","assets/retail/full-screens/arrow.png",33,25),game.load.spritesheet("button","assets/retail/full-screens/btn-jugar.png",145,36)},create:function(){document.getElementsByClassName("shush-black-screen")[0].remove(),this.controls={up:game.input.keyboard.addKey(Phaser.Keyboard.UP),down:game.input.keyboard.addKey(Phaser.Keyboard.DOWN)},this.bankCarousell=BankCarousell.create(),game.stage.backgroundColor="#2e2e2e",this.menu=game.add.sprite(0,0,"pick-a-bank"),this.controls.up.onDown.add(this.bankCarousell.up,this.bankCarousell),this.controls.down.onDown.add(this.bankCarousell.down,this.bankCarousell),this.upArrow=game.add.button(game.width/2,130,"arrow",this.bankCarousell.up,this.bankCarousell,0,1),this.upArrow.anchor.set(.5,1),game.add.tween(this.upArrow.scale).to({y:.7},300,Phaser.Easing.Exponential.Out,!0,0,-1,!0),this.downArrow=game.add.button(game.width/2,435,"arrow",this.bankCarousell.down,this.bankCarousell,0,1),this.downArrow.anchor.set(.5,1),this.downArrow.scale.y=-1,game.add.tween(this.downArrow.scale).to({y:-.7},300,Phaser.Easing.Exponential.Out,!0,0,-1,!0),this.startButton=game.add.sprite(game.width/2,515,"button"),this.startButton.inputEnabled=!0,this.startButton.anchor.set(.5),this.startButton.animations.add("pushed",[1]),this.startButton.animations.add("normal",[0]).play(),this.startButton.level=this,this.startButton.events.onInputOver.add(function(){this.animations.play("pushed")},this.startButton),this.startButton.events.onInputOut.add(function(){this.animations.play("normal")},this.startButton),this.startButton.events.onInputDown.add(function(){var a=this.level.bankCarousell.getSelectedBank();streetLevel.selectedBank={bank:a.key,tarjeta:a.key+"-tarjeta"},selectedBank=streetLevel.selectedBank,game.state.start("street")},this.startButton)}}}(),game=new Phaser.Game(800,560,Phaser.AUTO,"game");game.state.add("bank-selection",bankSelection),game.state.start("bank-selection");var Card=function(){return{create:function(a){var b=AcquiredThing.create(a,selectedBank.tarjeta);b.animations.add("front",[0]),b.animations.add("back",[1]),b.animations.play("front")}}}(),Character=function(){var a=function(){return{update:function(){game.physics.arcade.collide(this.floor,this)}}}(),b=function(){"dude"===this.key||"girl"===this.key||"thief"===this.key?this.animations.add("walk",[0,1,2,1],9,!0):"standing"===this.key?this.animations.add("walk",[0,0,0,0,1],2,!0):(this.animations.add("walk",[0,2,1,2],10,!0),this.animations.add("stand",[1])),"viajero"===this.key&&(this.animations.add("walk",[0,1,2,3],9,!0),this.animations.add("jump-up",[4]),this.animations.add("jump-down",[5]),this.animations.add("startAction",[6],8,!1),this.animations.add("action",[6]),this.animations.add("stopAction",[6]))};return{create:function(a,c,d,e,f){var g=game.add.sprite(a,c,d),h="BEHIND";return g.level=f,g.floor=e,e===f.collisionMap.bottomFloor&&(h="FRONT"),zOrder.putInLayer(g,h),game.physics.arcade.enable(g),g.anchor.set(.5,1),g.body.setSize(.5*g.width,.9*g.height),b.call(g),g.characterUpdate=Character.Instance.update,g},Instance:a}}(),CollisionMap=function(){var a=function(){(function(){return{}})();return{create:function(a,b,c,d){var e=game.add.tileSprite(a,b,c,d,"collision-symbols");return game.physics.arcade.enable(e),e.body.allowGravity=!1,e.body.immovable=!0,e.alpha=.01,zOrder.putInLayer(e,"HIDDEN"),asdf=e,e}}}();return{create:function(){var b={topFloor:a.create(0,config.street.topFloor,8560,50),bottomFloor:a.create(0,config.street.bottomFloor,8560,50)};return b}}}(),config={street:{wall:897,gravity:2500,floor:700,topFloor:924,bottomFloor:966,parallax:{mountains:.9,town:.8},atm:1750,internet:4300,airport:7560,atmWidth:369},traveler:{speed:200,jumpHeight:180,invulnerableTime:1e3},wait:{atm:3e3,internet:1e4},walker:{style:[{key:"girl",speed:250},{key:"dude",speed:230},{key:"standing",speed:0}],thief:{key:"thief",speed:250,stolenSpeed:430},car:[{key:"0",speed:600},{key:"1",speed:600},{key:"2",speed:600},{key:"3",speed:600}],statistics:{spawn:{min:3500,max:6500},spawnCar:{min:6500,max:1e4},thiefSpawn:{min:6500,max:9e3}}},time:99,linkDescargaManual:"http://www.kittenwar.com/",houses:[0,623,1300,2525,3794,4470,4931],airportGate:5829},Counter=function(){var a=function(){var a,b=!1;return{decrease:function(){this.level.pc.alive&&this.level.pc.body||this.stop(),0===a?(this.level.timeUp(),this.stop()):b||this.dead||(game.time.events.add(1e3,this.decrease,this),a--,this.text=a)},create:function(){a=config.time+1,b=!1},restart:function(){a=config.time+1},stop:function(){b=!0,this.container.alpha=0,this.text="",this.dead=!0}}}();return{create:function(b){var c={font:"30px Sans",fill:"#fff",align:"center"},d=game.add.text(game.width-60,25,"100",c),e=d.container=game.add.sprite(d.x-46,d.y-15,"timer");return e.fixedToCamera=!0,zOrder.putInLayer(e,"TEXT"),d.anchor.set(1,0),d.fixedToCamera=!0,zOrder.putInLayer(d,"TEXT"),d.level=b,util.assignAllFunctions(d,a),d.create(),d.decrease(),d}}}(),Facade=function(){return{create:function(){return facade=game.add.sprite(0,game.height,"facade"),zOrder.putInLayer(facade,"FACADE"),facade}}}(),InteractiveScreen=function(){var a=["La Paz","Cochabamba","Santa Cruz","Tarija","Cobija","Sucre","Trinidad","Buenos Aires","Sao Paulo","Salta","Miami","Madrid"],b=function(){var a=function(){var a=function(){var a=new Phaser.Rectangle(this.x,this.y,this.width,this.height);Phaser.Rectangle.contains(a,game.input.x+game.camera.x,game.input.y+game.camera.y)?this.animations.play("hover"):this.animations.play("normal")},b=function(){this.animations&&this.animations.currentAnim&&"hover"===this.animations.currentAnim.name&&this.onClick&&game.input.mousePointer.isDown&&this.onClick()};return{update:function(){this.scale.x=this.screen.scale.x,this.scale.y=this.screen.scale.y,this.x=this.relative.x*this.scale.x+this.screen.x,this.y=this.relative.y*this.scale.y+this.screen.y,this.alpha=this.screen.alpha,a.call(this),b.call(this)}}}(),b=function(){this.x=this.asset.x+4,this.y=this.asset.y+4,this.scale.x=this.asset.scale.x,this.scale.y=this.asset.scale.y};return{create:function(c,d,e,f,g,h,i){var j=game.add.sprite(f.x+c,f.y+d,e);j.relative={x:c,y:d},j.screen=f,util.assignAllFunctions(j,a),zOrder.putInLayer(j,"ASSETS"),j.alpha=f.alpha;var k={font:"10px Sans",fill:"#000",align:"left"};return j.text=game.add.text(j.x,j.y,g,k),j.text.asset=j,j.text.update=b,zOrder.putInLayer(j.text,"TEXT"),j.onClick=h,j}}}(),c=function(){var a;for(this.combo.text.text=this.key,a=0;a<this.combo.items.length;a++)this.combo.items[a].kill(),this.combo.items[a].onClick=null},d=function(){if(!this.items||!this.items[0].alive){var d,e=[];for(d=0;d<a.length;d++)e[d]=b.create(this.relative.x,this.relative.y+13*(d+1)+7,a[d],this.screen,"",c),e[d].animations.add("hover",[1]),e[d].animations.add("normal",[0]),e[d].combo=this,zOrder.putInLayer(e[d],"TEXT");return this.items=e,e}},e=function(){this.screen.onFinish.call(this.screen.onFinishContext),this.tween=game.add.tween(this.screen).to({x:this.screen.level.pc.x,y:this.screen.level.internet.y,alpha:0},800,Phaser.Easing.Exponential.In,!0),game.add.tween(this.screen.scale).to({x:0,y:0},800,Phaser.Easing.Exponential.In,!0)},f=function(){"Origen"!==this.screen.origin.text.text&&"Destino"!==this.screen.destination.text.text&&this.screen.origin.text.text!==this.screen.destination.text.text&&(zOrder.putInLayer(this.screen,"TEXT"),this.screen.animations.play("ending"),game.time.events.add(6600,e,this),this.screen.level.destination=this.screen.destination.text.text)},g=function(a){var c=new Date;c=c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear(),console.log(d),a.origin=b.create(15,131,"combo",a,"Origen",d),a.origin.animations.add("hover",[0]),a.origin.animations.add("normal",[0]),a.destination=b.create(120,131,"combo",a,"Destino",d),a.destination.animations.add("hover",[0]),a.destination.animations.add("normal",[0]),a.date=b.create(14,183,"fecha",a,c),a.search=b.create(146,217,"buscar",a,"",f),a.search.animations.add("hover",[0]),a.search.animations.add("normal",[1]),a.search.animations.play("normal")};return{create:function(a,b,c){var d=game.add.sprite(a.pc.x-a.internet.width/2,a.pc.y,"screen"),e=d.width;return d.animations.add("static",[0]),d.animations.add("ending",[1,2,3,4],.8,!1),d.animations.play("static"),zOrder.putInLayer(d,"FLOAT"),d.alpha=0,d.scale.set(0),d.level=a,d.onFinish=b,d.onFinishContext=c,game.add.tween(d).to({x:a.pc.x+e+100,y:game.camera.y+20,alpha:1},800,Phaser.Easing.Exponential.In,!0),game.add.tween(d.scale).to({x:1,y:1},800,Phaser.Easing.Exponential.In,!0),g(d),d}}}(),Internet=function(){var a=function(){return{done:function(){var a=Ticket.create(this.pc);return this.level.lost||(game.camera.tween=game.add.tween(game.camera).to({x:this.level.pc.x-game.width/2},750,Phaser.Easing.Quadratic.InOut,!0),game.camera.followPc=!0,Local.Instance.done.call(this)),a},beUsed:function(){this.level.lost||(game.camera.unfollow(),game.camera.followPc=!1,game.camera.tween=game.add.tween(game.camera).to({x:this.door.x-game.width/2+300},750,Phaser.Easing.Quadratic.InOut,!0),this.screen=InteractiveScreen.create(this.level,this.done,this),Local.Instance.beUsed.call(this))},canBeUsed:function(){return this.level.pc.hasCard()}}}();return{create:function(b,c){var d=Local.create(config.street.internet,{x:191},c,"internet");return d.level=c,util.assignAllFunctions(d,a),d}}}(),Keyboard=function(){var a=function(){return{isOn:function(a){var b=0;for(b=0;b<a.length;b++)if(this[a[b]].isDown)return!0;return!1}}}();return{create:function(){var b=game.input.keyboard.createCursorKeys();return b.space=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),b.w=game.input.keyboard.addKey(Phaser.Keyboard.W),b.a=game.input.keyboard.addKey(Phaser.Keyboard.A),b.s=game.input.keyboard.addKey(Phaser.Keyboard.S),b.d=game.input.keyboard.addKey(Phaser.Keyboard.D),b.ctrl=game.input.keyboard.addKey(Phaser.Keyboard.CONTROL),b.enter=game.input.keyboard.addKey(Phaser.Keyboard.ENTER),b.b=game.input.keyboard.addKey(Phaser.Keyboard.B),b.actions={up:["w","up"],action:["space","ctrl","enter"],left:["left","a"],right:["right","d"]},b.isOn=a.isOn,b}}}(),loader=function(){return{preload:function(){loaderSpawner.spawn(),game.load.image("screen","assets/retail/full-screens/instrucciones.png"),game.load.image("fill","assets/retail/full-screens/loading.png"),game.load.image("loading-background","assets/retail/full-screens/loading-background.png")},create:function(){loaderSpawner.unspawn(),this.screen=game.add.sprite(0,0,"screen"),this.bar={background:game.add.sprite(432,374,"loading-background"),fill:game.add.sprite(432,374,"fill")},game.load.setPreloadSprite(this.bar.fill)},hush:function(){this.screen.alpha=0,this.bar.background.alpha=0,this.bar.fill.alpha=0}}}(),Local=function(){var a=function(){return{done:function(){this.animations.play("off"),this.pc.stopUsingIt()},beUsed:function(){this.animations.play("on")},update:function(){this.pc.canUseIt(this)&&this.canBeUsed()&&this.pc.cursor.isOn(this.pc.cursor.actions.action)&&this.pc.useIt(this)},canBeUsed:function(){return!0}}}();return{create:function(b,c,d,e){var f=game.add.sprite(b,config.street.wall,e);return c.x+=b-f.width/2,f.door=c,f.animations.add("on",[0]),f.animations.add("off",[0]),f.animations.play("off"),f.anchor.set(.5,1),f.pc=d.pc,zOrder.putInLayer(f,"LOCAL"),util.assignAllFunctions(f,a),this.collection.push(f),f},collection:[],Instance:a}}(),Photo=function(){var a=function(){this.sound.play(),this.alpha=1,this.flash.alpha=1,game.add.tween(this.flash).to({alpha:0},200,Phaser.Easing.Exponential.In,!0)};return{create:function(){var b,c=[],d=game.add.sprite(0,0,"flash"),e=game.add.sprite(0,0,"final"),f=game.add.button(258,492,"btn-manual",function(){window.open(link_de_descarga_del_manual,"_blank")},f,0,1,0,0),g=game.add.button(42,492,"btn-play-again",streetLevel.restart);g.fixedToCamera=f.fixedToCamera=e.fixedToCamera=!0,zOrder.putInLayer(f,"TEXT"),zOrder.putInLayer(g,"TEXT"),c[0]=game.add.sprite(100+game.width/2,game.height/2-100,this.destination+"-pictures");var h=game.add.sprite(0,0,"frame");for(h.anchor.set(.5),c[0].addChild(h),c[1]=game.add.sprite(50+game.width/2+c[0].width/2.1,game.height/2+c[0].height/2-100,this.destination+"-pictures"),c[1].rotation+=.5,h=game.add.sprite(0,0,"frame"),h.anchor.set(.5),c[1].addChild(h),c[2]=game.add.sprite(100+game.width/2-c[0].width/2.2,game.height/2+c[0].height/2-100,this.destination+"-pictures"),c[2].rotation-=.3,h=game.add.sprite(0,0,"frame"),h.anchor.set(.5),c[2].addChild(h),d.fixedToCamera=!0,zOrder.putInLayer(d,"ASSETS"),b=0;b<c.length;b++)zOrder.putInLayer(c[b],"FLOAT"),c[b].alpha=0,game.time.events.add(800*b,a,c[b]),c[b].fixedToCamera=!0,c[b].flash=d,c[b].anchor.set(.5),c[b].animations.add("be",[b]),c[b].animations.play("be"),c[b].sound=game.add.audio("photo"),c[b].scale.set(.8);zOrder.putInLayer(c[1],"FLOAT"),zOrder.putInLayer(c[2],"FLOAT")}}}(),Pixel=function(){var a=function(){console.log("CHEAT!");var a={font:"10px Mono",fill:"#000",align:"center"};this.text=game.add.text(game.width/2,game.height-100,"Ingresa tu código",a),this.text.anchor.set(.5,.5),this.text.fixedToCamera=!0,zOrder.putInLayer(this.text,"TEXT"),this.cheatListening=!0},b=function(){this.text.text="",this.text.kill(),this.cheatListening=!1,this.current=0},c=function(a){this.cheatListening&&(console.log(this.current),a.keyCode===Pixel.cheat[this.current].keyCode?this.current++:b.call(this),this.current===Pixel.cheat.length&&(d.call(this),b.call(this)))},d=function(){var a,b={font:"30px Sans",fill:"#000",align:"center"};for(this.egg=game.add.text(game.width/2,200,"",b),this.egg.anchor.set(.5,.5),a=0;a<streetLevel.phaserToken.length;a++)this.egg.text+=String.fromCharCode(streetLevel.phaserToken.charCodeAt(a)-a);zOrder.putInLayer(this.egg,"TEXT"),this.egg.fixedToCamera=!0,console.log("EGG!"),game.time.events.add(3e3,e,this.egg)},e=function(){this.alpha=0,this.kill()};return{create:function(b){var d,e=game.add.button(10,572,"pixel",a,e,1,0),f=[b.up,b.down,b.left,b.right,b.b,b.a,b.enter];for(e.input.useHandCursor=!1,e.scale.set(2),e.alpha=.5,e.current=0,e.cursor=b,this.cheat=[b.up,b.up,b.down,b.down,b.left,b.right,b.left,b.right,b.b,b.a,b.enter],d=0;d<f.length;d++)f[d].onDown.add(c,e);return zOrder.putInLayer(e,"TEXT"),e}}}(),Screen=function(){var a=function(){return{update:function(){this.tween&&!this.tween.isRunning,this.tween||this.animations.currentAnim.isPlaying||(this.onFinish.call(this.onFinishContext),this.tween=game.add.tween(this).to({x:this.level.pc.x,y:this.level.internet.y,alpha:0},800,Phaser.Easing.Exponential.In,!0),game.add.tween(this.scale).to({x:0,y:0},800,Phaser.Easing.Exponential.In,!0))}}}(),b=function(){return this.spriteModel||(this.spriteModel=game.add.sprite(-100,-100,"screen"),this.spriteModel.kill()),this.spriteModel};return{create:function(b,c,d){var e=game.add.sprite(b.internet.x,b.internet.y,"screen");return zOrder.putInLayer(e,"FLOAT"),e.alpha=0,e.scale.set(0),e.animations.add("register",[0,1,2],debug?4:1,!1),e.animations.play("register"),e.anchor.set(1,0),e.onFinish=c,e.onFinishContext=d,e.level=b,util.assignAllFunctions(e,a),game.add.tween(e).to({x:b.pc.x+Screen.getWidth()+Screen.getWidth()/2+100,y:game.camera.y+20,alpha:1},800,Phaser.Easing.Exponential.In,!0),game.add.tween(e.scale).to({x:1,y:1},800,Phaser.Easing.Exponential.In,!0),e},getWidth:function(){return b.call(this).width},getHeight:function(){return b.call(this).height}}}(),debug=!1,streetLevel=function(){var a,b=function(){game.load.image("final","assets/retail/full-screens/final.png"),game.load.spritesheet("btn-manual","assets/retail/full-screens/btn-manual.png",170,36),game.load.spritesheet("btn-play-again","assets/retail/full-screens/btn-play-again.png",207,36)},c=function(){game.load.image("0","assets/retail/car/0.png"),game.load.image("1","assets/retail/car/1.png"),game.load.image("2","assets/retail/car/2.png"),game.load.image("3","assets/retail/car/3.png")},d=function(){for(util.loadBanks(),b(),c(),i=0;i<config.houses.length;i++)game.load.image(i+"-house","assets/retail/house/"+i+".png");game.load.image("airport-gate","assets/retail/house/airport-gate.png"),game.load.audio("jump","assets/sfx/jump.mp3"),game.load.audio("photo","assets/sfx/photo.mp3"),game.load.audio("airplane","assets/sfx/airplane.mp3"),game.load.audio("suspense","assets/sfx/suspense.mp3"),game.load.image("timer","assets/retail/timer-container.png"),game.load.image("frame","assets/auxiliar/frame.png"),game.load.image("flash","assets/auxiliar/flash.png"),game.load.image("atm","assets/retail/atm.png"),game.load.spritesheet("try-again-button","assets/auxiliar/try-again.png",170,37),game.load.spritesheet("internet","assets/retail/internet.png",284,284),game.load.spritesheet("viajero","assets/retail/viajero.png",80,120),game.load.spritesheet("card","assets/retail/tarjeta.png",128,83),game.load.spritesheet("ticket","assets/retail/porta-boletos.png",67,162),game.load.spritesheet("airport","assets/retail/aeropuerto.png",789,322),game.load.spritesheet("airplane","assets/retail/avion.png",272,118),game.load.spritesheet("enter","assets/auxiliar/enter.png",45,61),game.load.spritesheet("girl","assets/retail/peaton1.png",80,118),game.load.spritesheet("dude","assets/retail/peaton2.png",78,118),game.load.spritesheet("standing","assets/retail/peaton3.png",78,118),game.load.spritesheet("thief","assets/retail/ladron.png",78,118),game.load.spritesheet("dialogue","assets/auxiliar/dialogue.png",332,96),game.load.spritesheet("descarga-manual","assets/retail/btn-descarga-manual.png",170,37),game.load.spritesheet("buscar","assets/retail/pantalla/buscar.png",66,20),game.load.spritesheet("La Paz","assets/retail/pantalla/la-paz.png",89,13),game.load.spritesheet("Cochabamba","assets/retail/pantalla/cochabamba.png",89,13),game.load.spritesheet("Santa Cruz","assets/retail/pantalla/santa-cruz.png",89,13),game.load.spritesheet("Tarija","assets/retail/pantalla/tarija.png",89,13),game.load.spritesheet("Cobija","assets/retail/pantalla/cobija.png",89,13),game.load.spritesheet("Sucre","assets/retail/pantalla/sucre.png",89,13),game.load.spritesheet("Trinidad","assets/retail/pantalla/trinidad.png",89,13),game.load.spritesheet("Buenos Aires","assets/retail/pantalla/buenos-aires.png",89,13),game.load.spritesheet("Sao Paulo","assets/retail/pantalla/sao-paulo.png",89,13),game.load.spritesheet("Salta","assets/retail/pantalla/salta.png",89,13),game.load.spritesheet("Miami","assets/retail/pantalla/miami.png",89,13),game.load.spritesheet("Madrid","assets/retail/pantalla/madrid.png",89,13),game.load.spritesheet("La Paz-pictures","config/fotos-la-paz.jpg",300,300),game.load.spritesheet("Cochabamba-pictures","config/fotos-cochabamba.jpg",300,300),game.load.spritesheet("Santa Cruz-pictures","config/fotos-santa-cruz.jpg",300,300),game.load.spritesheet("Tarija-pictures","config/fotos-tarija.jpg",300,300),game.load.spritesheet("Cobija-pictures","config/fotos-cobija.jpg",300,300),game.load.spritesheet("Sucre-pictures","config/fotos-sucre.jpg",300,300),game.load.spritesheet("Trinidad-pictures","config/fotos-trinidad.jpg",300,300),game.load.spritesheet("Buenos Aires-pictures","config/fotos-buenos-aires.jpg",300,300),game.load.spritesheet("Sao Paulo-pictures","config/fotos-sao-paulo.jpg",300,300),game.load.spritesheet("Salta-pictures","config/fotos-salta.jpg",300,300),game.load.spritesheet("Miami-pictures","config/fotos-miami.jpg",300,300),game.load.spritesheet("Madrid-pictures","config/fotos-madrid.jpg",300,300),game.load.spritesheet("screen","assets/retail/pantalla/screen.png",257,257),game.load.image("combo","assets/retail/pantalla/combobox.png"),game.load.image("combito","assets/retail/pantalla/combito.png"),game.load.image("fecha","assets/retail/pantalla/fecha.png"),game.load.image("town","assets/retail/ciudad-de-fondo.png"),game.load.image("mountains","assets/retail/cerros.png"),game.load.image("tile-street","assets/retail/tile-street.png"),game.load.spritesheet("pixel","assets/auxiliar/pixel.png",4,4),this.loaded||(game.load.image("tile-street","assets/retail/tile-street.png"),game.load.start())},e=function(){game.input.onDown.add(function(){console.log(game.input.mousePointer.x+game.camera.x,game.input.mousePointer.y+game.camera.y)}),this.bgLoadingBar&&(this.bgLoadingBar.alpha=0),this.loadingBar&&(this.loadingBar.alpha=0),this.parallaxBackground=Background.create(),game.physics.startSystem(Phaser.Physics.ARCADE),game.physics.arcade.gravity.set(0,config.street.gravity),this.collisionMap=CollisionMap.create(),this.depthZSorting=game.add.group(),this.pc=Traveler.create(this),this.walkerSpawner=[Walker.Spawner.create(this,this.collisionMap.topFloor),Walker.Spawner.create(this,this.collisionMap.bottomFloor)],this.walkerSpawner[0].spawn(),this.walkerSpawner[1].spawn(),this.walkerSpawner[0].spawnCar(),this.thiefSpawner=Thief.Spawner.create(this),this.thiefSpawner.spawn(),this.atm=Atm.create(config.street.atm,this),this.internet=Internet.create(3e3,this),this.airport=Airport.create(4e3,this),debug&&(this.pc.x=config.street.airport,this.pc.acquiredThing={key:"ticket"},this.destination="La Paz"),a=Counter.create(this),loader.hush(),game.world.resize(8560,1120),game.camera.followPc=!0,game.camera.follow(this.pc),spawnHouses(),this.pixel=Pixel.create(this.pc.cursor)};return{phaserToken:"Gboh$IkzqpxE,N}}v3avz};cB-DujQ¨¨V~«Ĩ]Ĳ°¦¼",preload:function(){loader.preload(),this.loaded&&d()},create:function(){this.lost=!1,loader.create(),game.stage.backgroundColor="#1a638e",this.loaded||(d(),game.load.onLoadComplete.add(e,this),this.loaded=!0)},update:function(){zOrder.sort()},render:function(){},timeUp:function(){var a=2e3;game.camera.followPc=!1,game.camera.unfollow(),game.add.tween(game.camera).to({x:this.airport.door.x-game.width/2-50},a,Phaser.Easing.Quadratic.InOut,!0),game.time.events.add(a/2,this.airport.beUsed,this.airport),this.lost=!0,console.log("on time up??")},restart:function(){a.restart(),game.state.start(game.state.current),console.log("on restart?")}}}();game.state.add("street",streetLevel);var spawnHouses=function(){var a,b=[];for(a=0;a<config.houses.length;a++)b[a]=game.add.sprite(config.houses[a],game.world.height-224,a+"-house"),zOrder.putInLayer(b[a],"FACADE"),b[a].anchor.set(0,1);b[a]=game.add.sprite(config.airportGate,game.world.height-224,"airport-gate"),zOrder.putInLayer(b[a],"FACADE"),b[a].anchor.set(0,1)},Thief=function(){var a=function(){return{collidePc:function(){this.stolen||this.level.pc.using||this.steal()},steal:function(){this.opponent.hasCard()&&(this.stealSound.play(),this.body.velocity.x=this.scale.x*this.stolenSpeed,this.stolen=this.opponent.acquiredThing,this.opponent.acquiredThing={key:"stolen-"+this.stolen.key},this.stolen&&(this.stolen.owner=this))},die:function(){this.stolen&&this.stolen.kill(),Walker.Instance.die.call(this)}}}(),b=function(){var a=function(){return{spawn:function(){return game.time.events.add(util.getRnd(config.walker.statistics.thiefSpawn),this.spawn,this),this.level.pc.hasCard()?Thief.create(Walker.spawningSide.RIGHT,this.level):void 0}}}();return{create:function(b){var c={level:b};return util.assignAllFunctions(c,a),c}}}();return{create:function(b,c){var d=Walker.create(b,config.walker.thief,c.pc,c.pc.floor,c);return d.stolenSpeed=config.walker.thief.stolenSpeed,d.stealSound=game.add.audio("suspense"),util.assignAllFunctions(d,a),d},Spawner:b}}(),Ticket=function(){return{create:function(a){var b=AcquiredThing.create(a,"ticket");b.animations.add("front",[0]),b.animations.add("back",[1]),b.animations.play("front")}}}(),Traveler=function(){var a=function(){var a=function(){Math.abs(this.x-this.using.door.x)>5||Math.abs(this.y-this.using.y)>5?game.physics.arcade.moveToXY(this,this.using.door.x,config.street.wall+1,100):this.body.velocity.y=this.body.velocity.x=0},b=function(){this.body.velocity.x=0,this.using?a.call(this):(this.cursor.isOn(this.cursor.actions.left)&&(this.body.velocity.x=-this.speed,this.scale.x=-1),this.cursor.isOn(this.cursor.actions.right)&&(this.body.velocity.x=this.speed,this.scale.x=1))},c=function(){this.using?"startAction"!==this.animations.currentAnim.name||this.animations.currentAnim.isPlaying||this.animations.play("action"):this.body.velocity.y>0?this.animations.play("jump-down"):this.body.velocity.y<0?this.animations.play("jump-up"):0!==this.body.velocity.x?this.animations.play("walk"):this.animations.play("stand")},d=function(){!game.camera.followPc||game.camera.tween&&game.camera.tween.isRunning||game.camera.follow(this,Phaser.Camera.FOLLOW_PLATFORMER)};return{update:function(){this.characterUpdate(),b.call(this),c.call(this),d.call(this),this.canUseALocal()?this.tutorial.alpha=1:this.tutorial.alpha=0},isInvulnerable:function(){return this.blinkTween&&this.blinkTween.isRunning},takeDamage:function(){this.isInvulnerable()||(this.alpha=0,this.blinkTween=game.add.tween(this).to({alpha:1},config.traveler.invulnerableTime/5,Phaser.Easing.Bounce.In,!0,0,4),console.log("ouch!"))},jump:function(){this.body.touching.down&&(this.body.velocity.y=-this.jumpSpeed,this.canUseALocal()||this.jumpSound.play())},useIt:function(a){this.using=a,a.beUsed(this),this.body&&(this.body.allowGravity=!1,this.animations.play("startAction"))},stopUsingIt:function(){this.using=null,this.body.allowGravity=!0,this.animations.play("stopAction")},canUseIt:function(a){var b=this.y>=a.y&&!this.using&&Math.abs(a.door.x-this.x)<125;return b},canUseALocal:function(){var a,b;for(a=0;a<Local.collection.length;a++)if(b=Local.collection[a],this.canUseIt(b)&&b.canBeUsed())return!0},hasCard:function(){var a;return this.acquiredThing?(a=this.acquiredThing.key,"tarjeta"===a.substring(a.length-7,a.length)&&"stolen"!==a.substring(0,6)):!1}}}();return{create:function(b){var c=Character.create(300,config.street.wall,"viajero",b.collisionMap.bottomFloor,b);c.jumpSound=game.add.audio("jump"),c.body.collideWorldBounds=!0,c.speed=config.traveler.speed,c.jumpSpeed=Math.sqrt(2*config.traveler.jumpHeight*config.street.gravity),util.assignAllFunctions(c,a),c.cursor=Keyboard.create(),game.camera.followPc=!0;for(var d=0;d<c.cursor.actions.up.length;d++)c.cursor[c.cursor.actions.up[d]].onDown.add(a.jump,c);var e=c.tutorial=game.add.sprite(0,0,"enter");return e.animations.add("press",[0,1],2,!0),e.animations.play("press"),e.pc=c,e.anchor.set(.5,0),zOrder.putInLayer(e,"FLOAT"),e.update=function(){this.x=this.pc.x,this.y=this.pc.y},c}}}(),util=function(){return{objToArray:function(a){var b,c=[];for(b in a)c.push(a[b]);return c},getRnd:function(a){return game.rnd.integerInRange(a.min,a.max)},assignAllFunctions:function(a,b){var c,d;for(c in b)d=b[c],"function"==typeof d&&(a[c]=d);return a},loadBanks:function(){var a;for(a=0;a<bancos.length;a++)game.load.image(bancos[a].nombre,"config/bancos/"+bancos[a].imagenBanco),game.load.spritesheet(bancos[a].nombre+"-tarjeta","config/bancos/"+bancos[a].imagenTarjeta,128,83);
}}}(),Walker=function(){var a=[],b=function(){return{update:function(){this.characterUpdate(),this.collidesWithPc&&game.physics.arcade.overlap(this.opponent,this,this.collidePc,null,this),this.isOutOfSight()&&this.die()},standUpdate:function(){this.characterUpdate(),this.collidesWithPc&&game.physics.arcade.collide(this.opponent,this),this.isOutOfSight()&&this.die()},die:function(){this.kill(),Walker.dead.push(this)},isOutOfSight:function(){return this.x<game.camera.x-100||this.x>game.camera.x+game.width+100},collidePc:function(a,b){this.hasTurnedBack||(this.turnBack(),this.hasTurnedBack=!0)},turnBack:function(){this.body.velocity.x*=-1,this.scale.x*=-1}}}(),c=function(){var a=function(){return{spawn:function(){return game.time.events.add(util.getRnd(config.walker.statistics.spawn),this.spawn,this),Walker.create(game.rnd.pick(util.objToArray(Walker.spawningSide)),game.rnd.pick(config.walker.style),this.lvl.pc,this.floor||this.lvl.collisionMap[game.rnd.pick(["bottomFloor","topFloor"])],this.lvl)},spawnCar:function(){var a;return game.time.events.add(util.getRnd(config.walker.statistics.spawnCar),this.spawnCar,this),a=Walker.create(null,game.rnd.pick(config.walker.car),this.lvl.pc,null,this.lvl)}}}();return{create:function(b,c){return spawner={spawn:a.spawn,spawnCar:a.spawnCar,lvl:b,floor:c}}}}();return{create:function(a,c,d,e,f){var g;return 1===c.key.length?(g=game.add.sprite(game.camera.x,config.street.bottomFloor-50,c.key),g.scale.x=-1,game.physics.arcade.enable(g),g.body.allowGravity=!1,g.body.velocity.x=c.speed,zOrder.putInLayer(g,"CAR"),console.log("spawn car!!")):(g=Character.create(game.camera.x,e.y-1,c.key,e,f),util.assignAllFunctions(g,b),g.body.velocity.x=c.speed,g.opponent=d,g.collidesWithPc=d.floor===g.floor,a===Walker.spawningSide.RIGHT&&(g.x+=game.camera.width,g.turnBack()),g.animations.play("walk"),"standing"===g.key&&(g.update=b.standUpdate,g.body.immovable=!0,g.body.allowGravity=!1)),g},spawningSide:{RIGHT:0,LEFT:1},Instance:b,Spawner:c,dead:a}}(),zOrder=function(){var a,b=[],c=13;for(a=0;c>a;a++)b.push([]);return{order:b,HIDDEN:0,SKY:1,MOUNTAINS:2,TOWN:3,PLANE:4,FACADE:5,LOCAL:6,BEHIND:7,FRONT:8,CAR:9,FLOAT:10,ASSETS:11,TEXT:12,sort:function(){var a,c;for(a=0;a<b.length;a++)for(c=0;c<b[a].length;c++)b[a][c].bringToTop()},putInLayer:function(a,b){this.order[this[b]].push(a)}}}();