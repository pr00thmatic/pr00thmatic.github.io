var Skin=pc.createScript("skin");Skin.puzzle="nino_1_1",Skin.attributes.add("targetsColor",{type:"boolean",default:!0}),Skin.attributes.add("targetsSprite",{type:"boolean",default:!0}),Skin.prototype.initialize=function(){let t=pc.app.root.findByName("Skins").findByName(Skin.puzzle).findByName(this.entity.name).sprite;this.targetsSprite&&(this.entity.sprite.sprite=t.sprite),this.targetsColor&&(this.entity.sprite.color=t.color)},Skin.prototype.update=function(t){};(()=>{var t=pc.createScript("picker");t.attributes.add("camera",{type:"entity"}),t.prototype.initialize=function(){let t=this.app.mouse,e=this.app.touch;t.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),e&&e.on(pc.EVENT_TOUCHSTART,this.onMouseDown,this),t.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),e&&e.on(pc.EVENT_TOUCHMOVE,this.onMouseMove,this),t.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),e&&e.on(pc.EVENT_TOUCHCANCEL,this.onMouseUp,this),e&&e.on(pc.EVENT_TOUCHEND,this.onMouseUp,this),this.picked=null},t.prototype.update=function(t){},t.prototype.onMouseDown=function(t){if(Victory.triggered)return;let e=t.touches&&t.touches.length>0?t.touches[0]:t,i=this.camera.camera.screenToWorld(e.x,e.y,this.camera.camera.nearClip),o=this.camera.camera.screenToWorld(e.x,e.y,this.camera.camera.farClip),s=pc.app.systems.rigidbody.raycastFirst(i,o);if(s&&s.entity&&s.entity.script.draggable){this.picked=s,this.initialPosition=this.picked.entity.getPosition().clone();let t=this.camera.camera.worldToScreen(this.initialPosition);this.offset=(new pc.Vec3).sub2(t,e),this.fire("piecePicked",this.picked.entity)}t.event.preventDefault()},t.prototype.onMouseMove=function(t){if(Victory.triggered)return;let e=t.touches&&t.touches.length>0?t.touches[0]:t;if(this.picked){let t=this.camera.camera.screenToWorld(e.x+this.offset.x,e.y+this.offset.y,this.camera.getPosition().z-this.initialPosition.z);t=new pc.Vec3(t.x,t.y,1+.001*Draggable.clicks),this.picked.entity.setPosition(t)}t.event.preventDefault()},t.prototype.onMouseUp=function(t){Victory.triggered||(this.picked&&(this.fire("pieceDropped",this.picked.entity),this.picked=null),t.event.preventDefault())}})();var Draggable=pc.createScript("draggable");pc.events.attach(Draggable),Draggable.clicks=10,Draggable.prototype.initialize=function(){this.picker=utils.findInParent(this.entity,(t=>t.script&&t.script.picker)),this.status="store",this.picker&&(this.picker=this.picker.script.picker,this.picker.on("pieceDropped",this.onPieceDropped,this),this.picker.on("piecePicked",this.onPiecePicked,this)),Victory.on("restart",this.onRestart,this)},Draggable.prototype.update=function(t){this.slot&&!this.snapped&&(this.distance>1.3?this.removeSlot():this.setPosition(this.slot.getPosition()))},Draggable.prototype.onPiecePicked=function(t){t==this.entity&&(this.entity.setLocalScale(pc.Vec3.ONE.clone()),this.removeSlot(),this.snapped=!1,this.entity.children[0].sprite.drawOrder=Draggable.clicks++)},Draggable.prototype.onPieceDropped=function(t){this.entity},Draggable.prototype.removeSlot=function(){this.distance=void 0,this.slot=null},Draggable.prototype.setPosition=function(t){let e=this.slot.parent&&this.slot.parent.script&&this.slot.parent.script.toolboxSlots?"store":"right";t.add(new pc.Vec3(0,0,1+.001*Draggable.clicks)),"store"!==e&&this.entity.name!==this.slot.name&&(e="wrong",t.add(new pc.Vec3(.2,.2,0))),this.entity.setPosition(t),this.snapped=!0,this.status=e,Draggable.fire("draggableSnap",this,this.slot,e)},Draggable.prototype.onRestart=function(){this.status="store"};var Slot=pc.createScript("slot");Slot.checkSnap=function(t,i){let e=t.script.draggable;(!e.slot||e.distance>i.getPosition().distance(t.getPosition()))&&(e.slot=i,e.distance=e.slot.getPosition().distance(t.getPosition()))},Slot.attributes.add("pickerEntity",{type:"entity"}),Slot.prototype.initialize=function(){this.pickerEntity.script.picker.on("pieceDropped",this.onPieceDropped,this)},Slot.prototype.update=function(t){},Slot.prototype.onPieceDropped=function(t){Slot.checkSnap(t,this.entity)};(()=>{var e=pc.createScript("toolboxSlots");e.attributes.add("scaleFactor",{type:"number",default:.45}),e.attributes.add("pickerEntity",{type:"entity"}),e.prototype.initialize=function(){this.poofs=[]},e.prototype.setStoredPieces=function(e){this.page=0,this.storedPieces=e,utils.shuffle(this.storedPieces),this.updateBar(),this.pickerEntity.script.picker.on("pieceDropped",this.onPieceDropped,this),this.pickerEntity.script.picker.on("piecePicked",this.onPiecePicked,this),Draggable.on("draggableSnap",this.onDraggableSnap,this)},e.prototype.updateBar=function(){let e=this.entity.children;this.page=Math.max(0,this.page),e.length*this.page>=this.storedPieces.length&&(this.page=Math.ceil(this.storedPieces.length/e.length)-1);let t=0;for(let e=0;e<this.storedPieces.length;e++)this.storedPieces[e]&&(this.storedPieces[e].enabled=!1);for(let i=this.start();i<this.end();i++,t++)e[t].script.toolboxSlot.storedPieceIndex=i,this.storedPieces[i]&&this.displayPiece(this.storedPieces[i],e[t]),this.poofs&&this.poofs[i]&&(this.poofs[i]=!1,utils.recursiveParticleExecute(e[t].findByName("poof"),(e=>{e.play(),setTimeout((e=>{e.stop()}),300,e)})))},e.prototype.displayPiece=function(e,t){e.enabled=!0,e.setLocalScale(pc.Vec3.ONE.clone().mulScalar(this.scaleFactor)),e.setPosition(t.getPosition().add(new pc.Vec3(0,0,1)))},e.prototype.addPiece=function(e,t){let i=t.script.toolboxSlot.storedPieceIndex;if(this.storedPieces[i])for(let e=0,t=this.storedPieces.length;e<=t;e++)if(!this.storedPieces[e]){this.storedPieces[e]=this.storedPieces[i];break}this.storedPieces[i]=e,this.updateBar()},e.prototype.onDraggableSnap=function(e,t,i){"store"===i&&t.parent==this.entity&&this.addPiece(e.entity,t)},e.prototype.onPiecePicked=function(e){let t=this.storedPieces.indexOf(e);if(t<0)return;this.storedPieces[t]=null;for(let e=0;e<this.storedPieces.length;e++)if((e<this.start()||e>=this.end())&&this.storedPieces[e]){this.poofs[t]=!0,this.storedPieces[t]=this.storedPieces[e],this.storedPieces[e]=null;break}this.updateBar()},e.prototype.onPieceDropped=function(e){for(let t=0;t<this.entity.children.length;t++)Slot.checkSnap(e,this.entity.children[t])},e.prototype.start=function(){return this.entity.children.length*this.page},e.prototype.end=function(){return this.entity.children.length*(this.page+1)}})();pc.createScript("toolboxSlot");(()=>{var t=pc.createScript("toolboxManager");t.attributes.add("topEntity",{type:"entity"}),t.attributes.add("bottomEntity",{type:"entity"}),t.attributes.add("piecesParent",{type:"entity"}),t.prototype.initialize=function(){let t=[],e=[],i=this.piecesParent.children;utils.shuffle(i);for(let o=0;o<i.length;o++)(o%2==0?t:e).push(i[o]);this.topEntity.script.toolboxSlots.setStoredPieces(t),this.bottomEntity.script.toolboxSlots.setStoredPieces(e)}})();(()=>{var t=pc.createScript("pageButton");t.attributes.add("cameraEntity",{type:"entity"}),t.attributes.add("toolboxSlots",{type:"entity"}),t.attributes.add("increment",{type:"number"}),t.prototype.initialize=function(){utils.subscribeClick(this.onMouseDown,this)},t.prototype.onMouseDown=function(t){this.toolboxSlots.script.toolboxSlots.page+=this.increment,this.toolboxSlots.script.toolboxSlots.updateBar()}})();var Victory=pc.createScript("victory");pc.events.attach(Victory),Victory.attributes.add("piecesParent",{type:"entity"}),Victory.attributes.add("indicator",{type:"entity"}),Victory.prototype.initialize=function(){Draggable.on("draggableSnap",this.onSnap,this)},Victory.attributes.add("toolboxManagerEntity",{type:"entity"}),Victory.prototype.onSnap=function(t,i,r){if("right"===r){for(let t=0;t<this.piecesParent.children.length;t++)if("right"!==this.piecesParent.children[t].script.draggable.status)return;this.indicator.enabled=!0,Victory.triggered=!0}},Victory.prototype.restart=function(){Victory.triggered=!1,Victory.fire("restart"),this.indicator.enabled=!1,this.toolboxManagerEntity.script.toolboxManager.initialize()};(()=>{var t=pc.createScript("snappedOkParticles");t.attributes.add("particles",{type:"entity"}),t.prototype.initialize=function(){Draggable.on("draggableSnap",this.onSnap,this),this.timeout=-1},t.prototype.onSnap=function(t,i,e){"right"==e&&(this.particles.setPosition(t.entity.getPosition()),utils.recursiveParticleExecute(this.particles,(t=>{t.play()})),clearTimeout(this.timeout),this.timeout=setTimeout((t=>{utils.recursiveParticleExecute(t,(t=>{t.stop()}))}),400,this.particles))}})();(()=>{var t=pc.createScript("closeButton");t.attributes.add("cameraEntity",{type:"entity"}),t.attributes.add("victoryEntity",{type:"entity"}),t.prototype.initialize=function(){utils.subscribeClick(this.onMouseDown,this)},t.prototype.onMouseDown=function(t){this.victoryEntity.script.victory.restart()}})();(()=>{var t=pc.createScript("tweener");t.attributes.add("target",{type:"entity"}),t.attributes.add("animooted",{type:"entity"}),t.attributes.add("loopDuration",{type:"number"}),t.attributes.add("repetitions",{type:"number"}),t.attributes.add("totalDuration",{type:"number"}),t.attributes.add("playsOnAwake",{type:"boolean",default:!0}),t.prototype.initialize=function(){this.target||(this.target=this.entity),this.paused=!0,this.playsOnAwake&&this.animoot()},t.prototype.update=function(t){if(this.paused)return;this.elapsedAnimationTime+=t,this.t=pc.math.clamp(this.t+this.sign*t/this.loopDuration,0,1),1==this.t?(this.sign=-1,this.currentRepetitions++):0==this.t&&(this.sign=1);let i=pc.math.smootherstep(0,1,this.t);this.animooted.setPosition((new pc.Vec3).lerp(this.initialPosition,this.target.getPosition(),i)),this.animooted.setLocalScale((new pc.Vec3).lerp(this.initialScale,this.target.getLocalScale(),i)),this.animooted.setRotation((new pc.Quat).slerp(this.initialRotation,this.target.getRotation(),i)),this.repetitions<=0&&this.totalDuration<=0||(this.repetitions>0&&this.currentRepetitions>=this.repetitions||this.totalDuration>0&&this.elapsedAnimationTime>this.totalDuration)&&(this.paused=!0,this.fire("onAnimationEnd"))},t.prototype.animoot=function(){this.currentRepetitions=0,this.sign=1,this.t=0,this.elapsedAnimationTime=0,this.paused=!1,this.initialPosition=this.animooted.getPosition().clone(),this.initialScale=this.animooted.getLocalScale().clone(),this.initialRotation=this.animooted.getRotation().clone()}})();var utils={findInParent:function(e,t){do{if(t(e))return e;e=e.parent}while(e)},shuffle:function(e){for(let t=e.length-1;t>0;t--){let i=Math.min(t-1,Math.floor(pc.math.random(0,t))),c=e[i];e[i]=e[t],e[t]=c}},recursiveParticleExecute:function(e,t){if(!e)return;e.particlesystem&&t(e.particlesystem);let i=e.children;if(i)for(let e=0;e<i.length;e++)utils.recursiveParticleExecute(i[e],t)},subscribeClick:function(e,t){t.app.mouse.on(pc.EVENT_MOUSEDOWN,utils.executeIfClick(e,t),t),t.app.touch&&(t.app.touch.on(pc.EVENT_TOUCHCANCEL,utils.executeIfClick(e,t),t),t.app.touch.on(pc.EVENT_TOUCHEND,utils.executeIfClick(e,t),t))},executeIfClick:function(e,t){return i=>{let c=pc.app.root.findByName("Camera").camera,r=c.screenToWorld(i.x,i.y,c.nearClip),n=c.screenToWorld(i.x,i.y,c.farClip),l=pc.app.systems.rigidbody.raycastFirst(r,n);l&&l.entity===t.entity&&e.bind(t)(i)}}};(()=>{var t=pc.createScript("scallableCollider");t.attributes.add("originalScale",{type:"number",default:1}),t.prototype.initialize=function(){this.originalHalfExtents=this.entity.collision.halfExtents},t.prototype.update=function(t){let i=this.entity.getLocalScale();this.entity.collision.halfExtents=i.mul(this.originalHalfExtents)}})();(()=>{var t=pc.createScript("referenceButton");t.attributes.add("inTarget",{type:"entity"}),t.attributes.add("outTarget",{type:"entity"}),t.attributes.add("tweenerEntity",{type:"entity"}),t.prototype.initialize=function(){utils.subscribeClick(this.onClick,this),this.isOut=!0},t.prototype.onClick=function(t){this.isOut?this.tweenerEntity.script.tweener.target=this.inTarget:this.tweenerEntity.script.tweener.target=this.outTarget,this.tweenerEntity.script.tweener.animoot(),this.isOut=!this.isOut}})();(()=>{var t=pc.createScript("closeReferenceButton");t.attributes.add("referenceButtonEntity",{type:"entity"}),t.prototype.initialize=function(){utils.subscribeClick(this.onClick,this)},t.prototype.onClick=function(t){this.referenceButtonEntity.script.referenceButton.onClick(t)}})();